<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸ªäººç®€ä»‹ - ç‹¬ç«‹å¼€å‘è€…</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="container nav-container">
      <div class="logo">MyProfile</div>
      <nav class="nav">
        <a href="#home">é¦–é¡µ</a>
      </nav>
      <button class="nav-toggle" aria-label="åˆ‡æ¢å¯¼èˆª">
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <main>
    <section id="home" class="hero">
      <div class="container hero-content">
        <div class="hero-text">
          <!-- è¿™é‡Œæ”¹æˆäº†ä½ çš„åå­— -->
          <h1>ä½ å¥½ï¼Œæˆ‘æ˜¯<span class="highlight">åæ€å®</span></h1>
          
          <div class="hero-avatar">
            <!-- ç¡®ä¿ä½ çš„å›¾ç‰‡åæ˜¯è¿™ä¸ªï¼Œå¦‚æœä¸æ˜¯è¯·è‡ªè¡Œä¿®æ”¹ -->
            <img src="1767246246813.jpg" alt="åæ€å®" class="avatar-image" />
          </div>

          <!-- å¤©æ°”ç»„ä»¶ -->
          <div class="weather-widget" id="weatherWidget">
            <div class="weather-loading">åŠ è½½å¤©æ°”ä¸­...</div>
          </div>

          <!-- è‚¡ç¥¨ç»„ä»¶ -->
          <div class="stocks-container" id="stocksContainer">
            <div class="stock-loading">åŠ è½½æ•°æ®ä¸­...</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-content">
      <p>Â© <span id="year"></span> åæ€å®. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // 1. è‡ªåŠ¨æ›´æ–°å¹´ä»½
    document.getElementById('year').textContent = new Date().getFullYear();

    // 2. æ‰‹æœºç«¯å¯¼èˆªé€»è¾‘
    const navToggle = document.querySelector('.nav-toggle');
    const nav = document.querySelector('.nav');

    navToggle.addEventListener('click', () => {
      nav.classList.toggle('nav-open');
      navToggle.classList.toggle('nav-toggle-open');
    });

    nav.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        nav.classList.remove('nav-open');
        navToggle.classList.remove('nav-toggle-open');
      });
    });

    // 3. è‚¡ç¥¨é…ç½®æ¸…å• (å·²æ·»åŠ ä½ è¦æ±‚çš„ä¸¤ä¸ªETF)
    // è§„åˆ™ï¼šä¸Šæµ·äº¤æ˜“æ‰€åŠ  shï¼Œæ·±åœ³äº¤æ˜“æ‰€åŠ  sz
    const STOCKS = [
      { code: 'sz159898', name: '159898 åŒ»ç–—å™¨æ¢°ETF' },
      { code: 'sh601288', name: 'å†œä¸šé“¶è¡Œ' },
      { code: 'sh601919', name: 'ä¸­è¿œæµ·æ§' },
      { code: 'sh512690', name: 'é…’ETF' },
      { code: 'sh513050', name: '513050 ä¸­æ¦‚äº’è”ETF' }, // æ–°å¢
      { code: 'sz159567', name: '159567 é»„é‡‘è‚¡ETF' }   // æ–°å¢
    ];
    
    // è·å–å•åªè‚¡ç¥¨æ•°æ® (è…¾è®¯æ¥å£)
    function fetchStockData(stockCode) {
      return new Promise((resolve) => {
        const varName = `v_${stockCode}`;
        
        const script = document.createElement('script');
        script.charset = 'gb2312';
        script.src = `https://qt.gtimg.cn/q=${stockCode}`;
        
        script.onload = () => {
          // è¿™é‡Œçš„å»¶è¿Ÿæ˜¯ä¸ºäº†ç­‰å¾…å…¨å±€å˜é‡èµ‹å€¼å®Œæˆ
          setTimeout(() => {
            try {
              const globalVar = window[varName];
              if (globalVar) {
                const data = globalVar.split('~');
                // ç®€å•çš„é˜²é”™æ£€æŸ¥
                if (data.length > 3) {
                  const stockConfig = STOCKS.find(s => s.code === stockCode);
                  const name = stockConfig ? stockConfig.name : data[1];
                  
                  const currentPrice = parseFloat(data[3]);
                  const yesterdayClose = parseFloat(data[4]);
                  const todayOpen = parseFloat(data[5]);
                  const high = parseFloat(data[33]);
                  const low = parseFloat(data[34]);

                  // ä»·æ ¼ä¿®æ­£é€»è¾‘ï¼šå¦‚æœåœç‰Œæˆ–æœªå¼€ç›˜ï¼Œä¿æŒæ•°æ®åˆç†æ€§
                  const price = currentPrice > 0 ? currentPrice : yesterdayClose;
                  const change = price - yesterdayClose;
                  const changePercent = yesterdayClose > 0 ? ((change / yesterdayClose) * 100).toFixed(2) : '0.00';
                  
                  // æ¸…ç†å†…å­˜
                  script.remove();
                  delete window[varName];

                  resolve({
                    name,
                    price: price.toFixed(3), // ä¿ç•™3ä½å°æ•°æ›´ç²¾ç¡®
                    change: change.toFixed(3),
                    percent: changePercent,
                    isUp: change >= 0,
                    open: todayOpen.toFixed(2),
                    high: high.toFixed(2),
                    low: low.toFixed(2)
                  });
                  return;
                }
              }
            } catch (e) { }
            script.remove();
            resolve(null);
          }, 100);
        };
        
        script.onerror = () => { script.remove(); resolve(null); };
        document.head.appendChild(script);
      });
    }
    
    // æ¸²æŸ“è‚¡ç¥¨åˆ—è¡¨
    async function fetchStocks() {
      const container = document.getElementById('stocksContainer');
      const results = await Promise.all(STOCKS.map(s => fetchStockData(s.code)));
      
      let html = '';
      results.forEach((data, index) => {
        if (data) {
          // æ¶¨è·Œé¢œè‰²ç±»å
          const colorClass = data.isUp ? 'stock-up' : 'stock-down';
          const sign = data.isUp ? '+' : '';
          
          html += `
            <div class="stock-widget">
              <div class="stock-name-row">
                <span class="stock-name">ğŸ“ˆ ${data.name}</span>
              </div>
              <div class="stock-info">
                <span class="stock-price ${colorClass}">${data.price}</span>
                <span class="stock-change ${colorClass}">${sign}${data.change} (${sign}${data.percent}%)</span>
                <span class="stock-detail">ä»Šå¼€${data.open} | é«˜${data.high} | ä½${data.low}</span>
              </div>
            </div>
          `;
        } else {
          // å¦‚æœåŠ è½½å¤±è´¥ï¼Œä¿ç•™åå­—å ä½
          html += `<div class="stock-widget"><div class="stock-info"><span class="stock-name">${STOCKS[index].name}</span><span class="stock-error">æš‚æ— æ•°æ®</span></div></div>`;
        }
      });
      container.innerHTML = html;
    }

    // 4. å¤©æ°”é€»è¾‘ (ç²¾ç®€ç‰ˆ)
    async function fetchWeather() {
      const widget = document.getElementById('weatherWidget');
      try {
        const response = await fetch('https://wttr.in/æ²ˆé˜³?format=j1&lang=zh');
        const data = await response.json();
        const current = data.current_condition[0];
        
        widget.innerHTML = `
          <div class="weather-info">
            <span class="weather-location">ğŸ“ æ²ˆé˜³</span>
            <span class="weather-temp">${current.temp_C}Â°C</span>
            <span class="weather-desc">${current.lang_zh[0].value}</span>
            <span class="weather-humidity">æ¹¿åº¦ ${current.humidity}%</span>
          </div>
        `;
      } catch (e) {
        // æç®€é”™è¯¯å¤„ç†ï¼Œé™é»˜å¤±è´¥æˆ–æ˜¾ç¤ºç®€å•æç¤º
        widget.innerHTML = `<div class="weather-info"><span class="weather-location">ğŸ“ æ²ˆé˜³</span><span class="weather-desc">å¤©æ°”æ›´æ–°ä¸­...</span></div>`;
      }
    }

    // åˆå§‹åŒ–è¿è¡Œ
    fetchStocks();
    fetchWeather();
    
    // å®šæ—¶åˆ·æ–° (è‚¡ç¥¨10ç§’åˆ·ä¸€æ¬¡ï¼Œå¤©æ°”30åˆ†é’Ÿåˆ·ä¸€æ¬¡)
    setInterval(fetchStocks, 10000); 
    setInterval(fetchWeather, 1800000);
  </script>
</body>
</html>