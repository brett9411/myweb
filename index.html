<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸ªäººç®€ä»‹ - æ­£åœ¨æ¢ç´¢ AI çš„åˆ›é€ è€…</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="container nav-container">
      <div class="logo">MyProfile</div>
      <nav class="nav">
        <a href="#home">é¦–é¡µ</a>
      </nav>
      <button class="nav-toggle" aria-label="åˆ‡æ¢å¯¼èˆª">
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <main>
    <section id="home" class="hero">
      <div class="container hero-content">
        <div class="hero-text">
          <h1>ä½ å¥½ï¼Œæˆ‘æ˜¯<span class="highlight">åæ€å®</span></h1>
          <div class="hero-avatar">
            <img src="1767246246813.jpg" alt="åæ€å®" class="avatar-image" />
          </div>
          <div class="weather-widget" id="weatherWidget">
            <div class="weather-loading">åŠ è½½å¤©æ°”ä¸­...</div>
          </div>
          <div class="stocks-container" id="stocksContainer">
            <div class="stock-loading">åŠ è½½è‚¡ç¥¨ä¸­...</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-content">
      <p>Â© <span id="year"></span> åæ€å®. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // åŠ¨æ€å¹´ä»½
    document.getElementById('year').textContent = new Date().getFullYear();

    // æ‰‹æœºç«¯å¯¼èˆªåˆ‡æ¢
    const navToggle = document.querySelector('.nav-toggle');
    const nav = document.querySelector('.nav');

    navToggle.addEventListener('click', () => {
      nav.classList.toggle('nav-open');
      navToggle.classList.toggle('nav-toggle-open');
    });

    // ç‚¹å‡»å¯¼èˆªååœ¨æ‰‹æœºç«¯è‡ªåŠ¨æ”¶èµ·
    nav.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        if (nav.classList.contains('nav-open')) {
          nav.classList.remove('nav-open');
          navToggle.classList.remove('nav-toggle-open');
        }
      });
    });

    // è·å–æ²ˆé˜³å¤©æ°”
    async function fetchWeather() {
      const weatherWidget = document.getElementById('weatherWidget');
      try {
        // ä½¿ç”¨ wttr.in API è·å–å¤©æ°”ï¼ˆä¸éœ€è¦API keyï¼‰
        const response = await fetch('https://wttr.in/æ²ˆé˜³?format=j1&lang=zh');
        const data = await response.json();
        
        if (data && data.current_condition && data.current_condition[0]) {
          const current = data.current_condition[0];
          const temp = current.temp_C;
          const desc = current.lang_zh[0].value || current.weatherDesc[0].value;
          const humidity = current.humidity;
          
          weatherWidget.innerHTML = `
            <div class="weather-info">
              <span class="weather-location">ğŸ“ æ²ˆé˜³</span>
              <span class="weather-temp">${temp}Â°C</span>
              <span class="weather-desc">${desc}</span>
              <span class="weather-humidity">æ¹¿åº¦ ${humidity}%</span>
            </div>
          `;
        } else {
          throw new Error('å¤©æ°”æ•°æ®æ ¼å¼é”™è¯¯');
        }
      } catch (error) {
        console.error('è·å–å¤©æ°”å¤±è´¥:', error);
        // å¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
        try {
          const response = await fetch('https://wttr.in/æ²ˆé˜³?format=3');
          const text = await response.text();
          if (text) {
            weatherWidget.innerHTML = `
              <div class="weather-info">
                <span class="weather-location">ğŸ“ æ²ˆé˜³</span>
                <span class="weather-simple">${text.trim()}</span>
              </div>
            `;
          } else {
            throw new Error('å¤‡ç”¨æ–¹æ¡ˆä¹Ÿå¤±è´¥');
          }
        } catch (err) {
          weatherWidget.innerHTML = `
            <div class="weather-info">
              <span class="weather-location">ğŸ“ æ²ˆé˜³</span>
              <span class="weather-error">å¤©æ°”æ•°æ®æš‚æ—¶ä¸å¯ç”¨</span>
            </div>
          `;
        }
      }
    }

    // é¡µé¢åŠ è½½æ—¶è·å–å¤©æ°”
    fetchWeather();
    
    // æ¯30åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡å¤©æ°”
    setInterval(fetchWeather, 30 * 60 * 1000);

    // è‚¡ç¥¨åˆ—è¡¨é…ç½®
    const STOCKS = [
      { code: 'sz159898', name: '159898 åŒ»ç–—å™¨æ¢°ETF' }, // ETF
      { code: 'sh601288', name: 'å†œä¸šé“¶è¡Œ' },
      { code: 'sh601919', name: 'ä¸­è¿œæµ·æ§' },
      { code: 'sh512690', name: 'é…’ETF' } // é…’ETF
    ];
    
    // ä½¿ç”¨åŠ¨æ€scriptæ ‡ç­¾æ–¹å¼è·å–è‚¡ç¥¨æ•°æ®ï¼ˆç»•è¿‡CORSé™åˆ¶ï¼‰
    function fetchStockData(stockCode) {
      return new Promise((resolve) => {
        // æ–°æµªè´¢ç»APIä¼šè®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ ¼å¼ï¼švar hq_str_sh601288="æ•°æ®";
        // æˆ‘ä»¬éœ€è¦åœ¨scriptåŠ è½½åè¯»å–è¿™ä¸ªå˜é‡
        
        const varName = `hq_str_${stockCode}`;
        let resolved = false;
        
        // è®¾ç½®è¶…æ—¶
        const timeout = setTimeout(() => {
          if (!resolved) {
            resolved = true;
            const script = document.getElementById(`script_${stockCode}`);
            if (script) script.remove();
            resolve(null);
          }
        }, 8000); // 8ç§’è¶…æ—¶
        
        // åˆ›å»ºscriptæ ‡ç­¾
        const script = document.createElement('script');
        script.id = `script_${stockCode}`;
        script.charset = 'gb2312'; // æ–°æµªAPIä½¿ç”¨GB2312ç¼–ç 
        script.src = `https://hq.sinajs.cn/list=${stockCode}`;
        
        // ç›‘å¬scriptåŠ è½½å®Œæˆ
        script.onload = () => {
          if (resolved) return;
          
          // ç­‰å¾…ä¸€å°æ®µæ—¶é—´è®©å˜é‡è®¾ç½®å®Œæˆ
          setTimeout(() => {
            if (resolved) return;
            
            try {
              // è¯»å–å…¨å±€å˜é‡
              const globalVar = window[varName];
              
              if (globalVar && typeof globalVar === 'string') {
                // è§£ææ•°æ®ï¼šæ ¼å¼ "å†œä¸šé“¶è¡Œ,3.45,3.44,3.46,..."
                const data = globalVar.split(',');
                
                if (data.length >= 6 && data[0].trim()) {
                  const name = data[0].trim();
                  const todayOpen = parseFloat(data[1]) || 0;
                  const yesterdayClose = parseFloat(data[2]) || 0;
                  const currentPrice = parseFloat(data[3]) || yesterdayClose;
                  const high = parseFloat(data[4]) || 0;
                  const low = parseFloat(data[5]) || 0;
                  
                  const price = currentPrice > 0 ? currentPrice : yesterdayClose;
                  const change = price - yesterdayClose;
                  const changePercent = yesterdayClose > 0 ? ((change / yesterdayClose) * 100).toFixed(2) : '0.00';
                  const isUp = change >= 0;
                  
                  resolved = true;
                  clearTimeout(timeout);
                  script.remove();
                  
                  // æ¸…ç†å…¨å±€å˜é‡
                  try {
                    delete window[varName];
                  } catch (e) {}
                  
                  resolve({
                    name,
                    currentPrice: price,
                    change,
                    changePercent,
                    isUp,
                    todayOpen,
                    high,
                    low,
                    yesterdayClose
                  });
                  return;
                }
              }
            } catch (e) {
              console.error(`è§£æè‚¡ç¥¨æ•°æ®å¤±è´¥ ${stockCode}:`, e);
            }
            
            resolved = true;
            clearTimeout(timeout);
            script.remove();
            resolve(null);
          }, 100);
        };
        
        // é”™è¯¯å¤„ç†
        script.onerror = () => {
          if (!resolved) {
            resolved = true;
            clearTimeout(timeout);
            script.remove();
            resolve(null);
          }
        };
        
        // æ·»åŠ åˆ°é¡µé¢
        document.head.appendChild(script);
      });
    }
    
    async function fetchStocks() {
      const stocksContainer = document.getElementById('stocksContainer');
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      stocksContainer.innerHTML = '<div class="stock-loading">åŠ è½½è‚¡ç¥¨ä¸­...</div>';
      
      // å¹¶è¡Œè·å–æ‰€æœ‰è‚¡ç¥¨æ•°æ®
      const stockDataPromises = STOCKS.map(stock => fetchStockData(stock.code));
      const stockDataResults = await Promise.all(stockDataPromises);
      
      // æ„å»ºHTML
      let html = '';
      
      STOCKS.forEach((stock, index) => {
        const data = stockDataResults[index];
        
        if (data && data.currentPrice > 0) {
          // åˆ¤æ–­æ˜¯å¦åœ¨äº¤æ˜“æ—¶é—´ï¼ˆç®€å•åˆ¤æ–­ï¼šå¦‚æœå½“å‰ä»·ç­‰äºæ”¶ç›˜ä»·ï¼Œå¯èƒ½æ˜¯æ”¶ç›˜åï¼‰
          const now = new Date();
          const hour = now.getHours();
          const isTrading = hour >= 9 && hour < 15; // ç®€å•åˆ¤æ–­äº¤æ˜“æ—¶é—´
          const priceLabel = isTrading ? 'ç°ä»·' : 'æ”¶ç›˜';
          
          html += `
            <div class="stock-widget">
              <div class="stock-info">
                <span class="stock-name">ğŸ“ˆ ${data.name}</span>
                <span class="stock-price ${data.isUp ? 'stock-up' : 'stock-down'}">${data.currentPrice.toFixed(2)}</span>
                <span class="stock-change ${data.isUp ? 'stock-up' : 'stock-down'}">${data.isUp ? '+' : ''}${data.change.toFixed(2)} (${data.isUp ? '+' : ''}${data.changePercent}%)</span>
                <span class="stock-detail">å¼€${data.todayOpen.toFixed(2)} | é«˜${data.high.toFixed(2)} | ä½${data.low.toFixed(2)}</span>
              </div>
            </div>
          `;
        } else {
          html += `
            <div class="stock-widget">
              <div class="stock-info">
                <span class="stock-name">ğŸ“ˆ ${stock.name}</span>
                <span class="stock-error">åŠ è½½ä¸­...</span>
              </div>
            </div>
          `;
        }
      });
      
      // å¦‚æœæ‰€æœ‰è‚¡ç¥¨éƒ½åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºæç¤º
      const successCount = stockDataResults.filter(r => r !== null).length;
      if (successCount === 0) {
        html += '<div class="stock-error-message">è‚¡ç¥¨æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•</div>';
      }
      
      stocksContainer.innerHTML = html;
    }

    // é¡µé¢åŠ è½½æ—¶è·å–è‚¡ç¥¨
    fetchStocks();
    
    // æ¯5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡è‚¡ç¥¨ï¼ˆè‚¡ç¥¨æ•°æ®æ›´æ–°é¢‘ç‡è¾ƒé«˜ï¼‰
    setInterval(fetchStocks, 5 * 60 * 1000);
  </script>
</body>
</html>

