<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è‚¡ç¥¨è®°å½• - æˆ‘çš„ä¸ªäººæ©±çª—</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="container nav-container">
      <div class="logo">æˆ‘çš„ä¸ªäººæ©±çª—</div>
      <nav class="nav">
        <a href="#home">é¦–é¡µ</a>
      </nav>
      <button class="nav-toggle" aria-label="åˆ‡æ¢å¯¼èˆª">
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <main>
    <section id="home" class="hero">
      <div class="container hero-content">
        <div class="hero-text">
          <h1 class="hero-title-with-img">
            <img src="me-name.png" alt="Name" class="name-as-image" />
          </h1>

          <div class="clock-dashboard">
            <div class="clock-label">åŒ—äº¬æ—¶é—´ æ²ˆé˜³</div>
            <div class="clock-date" id="clockDate">0000.00.00 æ˜ŸæœŸä¸€ | è·ç¦»æ˜¥èŠ‚è¿˜æœ‰ 00 å¤©</div>
            <div class="beijing-clock" id="beijingClock">00:00:00</div>
          </div>
          
          <div class="hero-avatar">
            <img src="1767246246813.jpg" alt="Profile" class="avatar-image" />
          </div>

          <!-- å¤§ç›˜æŒ‡æ•° -->
          <div class="indices-container" id="indicesContainer">
            <div class="index-loading">æ­£åœ¨åŒæ­¥æŒ‡æ•°...</div>
          </div>

          <!-- æ–°å¢ï¼šä¸ªäººèµ„äº§ä»ªè¡¨ç›˜ -->
          <div class="portfolio-dashboard" id="portfolioDashboard">
            <div class="portfolio-item">
              <div class="p-label">æ€»èµ„äº§ (å…ƒ)</div>
              <div class="p-value" id="totalAssets">è®¡ç®—ä¸­...</div>
            </div>
            <div class="portfolio-item">
              <div class="p-label">å½“æ—¥ç›ˆäº (å…ƒ)</div>
              <div class="p-value" id="totalProfit">--</div>
            </div>
          </div>

          <!-- è‚¡ç¥¨å®¹å™¨ -->
          <div class="stocks-container" id="stocksContainer">
            <div class="stock-loading">æ­£åœ¨åŒæ­¥è¡Œæƒ…æ•°æ®...</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-content"></div>
  </footer>

  <script>
    const navToggle = document.querySelector('.nav-toggle');
    const nav = document.querySelector('.nav');
    navToggle.addEventListener('click', () => {
      nav.classList.toggle('nav-open');
      navToggle.classList.toggle('nav-toggle-open');
    });

    function updateClock() {
      const clockElement = document.getElementById('beijingClock');
      const dateElement = document.getElementById('clockDate');
      const now = new Date();
      const options = {
        timeZone: 'Asia/Shanghai',
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        weekday: 'long', hour12: false
      };
      const formatter = new Intl.DateTimeFormat('zh-CN', options);
      const parts = formatter.formatToParts(now);
      const val = (type) => parts.find(p => p.type === type).value;
      const springFestival = new Date('2026-02-17T00:00:00+08:00');
      const diffDays = Math.ceil((springFestival - now) / (1000 * 60 * 60 * 24));
      let countdownText = diffDays > 0 ? ` | è·ç¦»æ˜¥èŠ‚è¿˜æœ‰ ${diffDays} å¤©` : (diffDays === 0 ? ` | ğŸ§§ æ–°æ˜¥å¿«ä¹ï¼` : "");
      dateElement.textContent = `${val('year')}.${val('month')}.${val('day')} ${val('weekday')}${countdownText}`;
      clockElement.textContent = `${val('hour')}:${val('minute')}:${val('second')}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    const INDICES = [
      { code: 'sh000001', name: 'ä¸Šè¯æŒ‡æ•°' },
      { code: 'sz399006', name: 'åˆ›ä¸šæ¿æŒ‡' },
      { code: 'sh000688', name: 'ç§‘åˆ›50' }
    ];

    // --- åœ¨è¿™é‡Œä¿®æ”¹æŒä»“å’Œç°é‡‘ ---
    
    // 1. è®¾ç½®ä½ çš„å‰©ä½™ç°é‡‘ï¼ˆæˆ–è€…æ˜¯ç†è´¢ã€æœªæŠ•å…¥è‚¡å¸‚çš„é’±ï¼‰
    // ä¸ºäº†å‡‘æˆä½ æƒ³è¦çš„ 1433358.72ï¼Œæˆ‘å¤§æ¦‚ç®—äº†ä¸€ä¸‹ï¼Œä½ çš„è‚¡ç¥¨å¸‚å€¼çº¦ 110ä¸‡ï¼Œæ‰€ä»¥ç°é‡‘å¡«äº† 328000
    // å¦‚æœä½ æƒ³æ€»æ•°ç²¾ç¡®ç­‰äºæŸä¸ªå€¼ï¼Œä½ å¯ä»¥å¾®è°ƒè¿™ä¸ªæ•°å­—
    const CASH = 328681.72; 

    // 2. è‚¡ç¥¨é…ç½®ä¸æŒä»“
    const STOCKS = [
      { code: 'sz159898', name: '159898 åŒ»ç–—å™¨æ¢°ETF', holding: 0 },
      { code: 'sh601288', name: '601288 å†œä¸šé“¶è¡Œ', holding: 44200 },
      { code: 'sh601919', name: '601919 ä¸­è¿œæµ·æ§', holding: 30300 },
      { code: 'sh512690', name: '512690 é…’ETF', holding: 578700 },
      { code: 'sh513050', name: '513050 ä¸­æ¦‚äº’è”ETF', holding: 0 },
      { code: 'sz159567', name: '159567 æ¸¯è‚¡åˆ›æ–°è¯ETF', holding: 0 }
    ];

    // --- è‡ªåŠ¨æ’åºé€»è¾‘ï¼šæœ‰æŒä»“çš„æ’å‰é¢ ---
    // holding > 0 çš„æ’åœ¨ holding == 0 çš„å‰é¢
    STOCKS.sort((a, b) => {
      const holdingA = a.holding || 0;
      const holdingB = b.holding || 0;
      return (holdingB > 0) - (holdingA > 0);
    });
    
    function fetchStockData(stockCode) {
      return new Promise((resolve) => {
        const varName = `v_${stockCode}`;
        const script = document.createElement('script');
        script.charset = 'gb2312';
        script.src = `https://qt.gtimg.cn/q=${stockCode}`;
        script.onload = () => {
          setTimeout(() => {
            try {
              const globalVar = window[varName];
              if (globalVar) {
                const data = globalVar.split('~');
                if (data.length > 3) {
                  const currentPrice = parseFloat(data[3]);
                  const yesterdayClose = parseFloat(data[4]);
                  const price = currentPrice > 0 ? currentPrice : yesterdayClose;
                  const change = price - yesterdayClose;
                  const percent = yesterdayClose > 0 ? ((change / yesterdayClose) * 100).toFixed(2) : '0.00';
                  resolve({
                    code: stockCode,
                    name: data[1],
                    price: price.toFixed(3), // è¿™é‡Œçš„3ä½å°æ•°æ›´å‡†
                    change: change.toFixed(3),
                    percent,
                    isUp: change >= 0,
                    open: parseFloat(data[5]).toFixed(2),
                    high: parseFloat(data[33]).toFixed(2),
                    low: parseFloat(data[34]).toFixed(2)
                  });
                  return;
                }
              }
            } catch (e) { }
            script.remove(); resolve(null);
          }, 100);
        };
        script.onerror = () => { script.remove(); resolve(null); };
        document.head.appendChild(script);
      });
    }
    
    async function renderIndices() {
      const container = document.getElementById('indicesContainer');
      const results = await Promise.all(INDICES.map(s => fetchStockData(s.code)));
      let html = '';
      results.forEach(data => {
        if (data) {
          const colorClass = data.isUp ? 'stock-up' : 'stock-down';
          const sign = data.isUp ? '+' : '';
          // æŒ‡æ•°ä»·æ ¼é€šå¸¸ä¿ç•™2ä½
          const indexPrice = parseFloat(data.price).toFixed(2);
          const indexChange = parseFloat(data.change).toFixed(2);
          html += `
            <div class="index-card">
              <div class="index-name">${data.name}</div>
              <div class="index-price ${colorClass}">${indexPrice}</div>
              <div class="index-change ${colorClass}">${sign}${indexChange} (${sign}${data.percent}%)</div>
            </div>`;
        }
      });
      container.innerHTML = html;
    }

    async function renderStocks() {
      const container = document.getElementById('stocksContainer');
      const results = await Promise.all(STOCKS.map(s => fetchStockData(s.code)));
      
      let html = '';
      let totalStockValue = 0; // è‚¡ç¥¨æ€»å¸‚å€¼
      let totalDailyProfit = 0; // å½“æ—¥æ€»ç›ˆäº

      results.forEach(data => {
        if (data) {
          const colorClass = data.isUp ? 'stock-up' : 'stock-down';
          const sign = data.isUp ? '+' : '';
          const kLineUrl = `https://image.sinajs.cn/newchart/daily/n/${data.code}.gif`;
          
          const stockConfig = STOCKS.find(s => s.code === data.code);
          const displayName = stockConfig ? stockConfig.name : data.name;
          const holding = stockConfig ? (stockConfig.holding || 0) : 0;
          
          let profitHtml = '';
          if (holding > 0) {
            // è®¡ç®—å•åªè‚¡ç¥¨ç›ˆäº
            const dailyProfit = parseFloat(data.change) * holding;
            const profitSign = dailyProfit >= 0 ? '+' : '';
            // ç´¯åŠ æ€»ç›ˆäº
            totalDailyProfit += dailyProfit;
            // ç´¯åŠ æ€»å¸‚å€¼
            totalStockValue += parseFloat(data.price) * holding;

            // æ˜¾ç¤ºæ ¼å¼åŒ–åçš„å•åªç›ˆäº
            profitHtml = `<div class="daily-profit ${colorClass}">ä»Šæ—¥ç›ˆäº: ${profitSign}${dailyProfit.toFixed(2)}</div>`;
          }

          html += `<div class="stock-widget">
            ${profitHtml}
            <div class="stock-name-row"><span class="stock-name">ğŸ“ˆ ${displayName}</span></div>
            <div class="stock-info">
              <span class="stock-price ${colorClass}">${parseFloat(data.price).toFixed(3)}</span>
              <span class="stock-change ${colorClass}">${sign}${parseFloat(data.change).toFixed(3)} (${sign}${data.percent}%)</span>
              <span class="stock-detail">ä»Šå¼€${data.open} | é«˜${data.high} | ä½${data.low}</span>
            </div>
            <div class="stock-chart"><img src="${kLineUrl}" alt="Chart" /></div>
          </div>`;
        }
      });
      
      container.innerHTML = html;

      // --- æ›´æ–°é¡¶éƒ¨çš„æ€»èµ„äº§é¢æ¿ ---
      // æ€»èµ„äº§ = è‚¡ç¥¨æ€»å¸‚å€¼ + ç°é‡‘
      const finalAssets = totalStockValue + CASH;
      
      const assetsEl = document.getElementById('totalAssets');
      const profitEl = document.getElementById('totalProfit');
      
      // æ•°å­—æ ¼å¼åŒ–ï¼ˆåŠ é€—å·ï¼‰
      assetsEl.textContent = finalAssets.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      
      const profitSign = totalDailyProfit >= 0 ? '+' : '';
      const profitColor = totalDailyProfit >= 0 ? '#ff5e5e' : '#4ade80';
      
      profitEl.textContent = `${profitSign}${totalDailyProfit.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
      profitEl.style.color = profitColor;
    }

    function refreshAll() {
      renderIndices();
      renderStocks();
    }

    refreshAll();
    setInterval(refreshAll, 10000); 
  </script>
</body>
</html>